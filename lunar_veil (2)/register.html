<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lunar Veil Cafe ☕ — New User Registration</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* Inherit base styles for dark, space theme */
    :root{
      --color-dark: #0A0A1F;
      --color-primary: #8A2BE2; 
      --color-secondary: #FFD700; 
      --color-accent: #2c254b; 
      --color-light: #E0E0E0; 
      --color-error: #FF6347; 
      --font-heading: 'Cinzel', serif;
      --font-body: 'Inter', sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;font-family:var(--font-body);background-color:var(--color-dark);color:var(--color-light);
      background-image: radial-gradient(var(--color-accent) 1px, transparent 0), radial-gradient(var(--color-accent) 1px, transparent 0);
      background-size:80px 80px;background-position:0 0,40px 40px;
      display: flex; 
      justify-content: center;
      align-items: center;
      padding: 20px; /* Added padding for smaller screens */
    }
    .form-card {
        width: 100%;
        max-width: 400px; 
        padding: 40px;
        background-color: #1a1a36; 
        border-radius: 12px;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
    }
    .form-card h2 {
        font-family: var(--font-heading);
        color: var(--color-secondary); 
        text-align: center;
        margin-bottom: 30px;
        font-size: 1.8rem;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--color-light);
    }
    .form-group input, .form-group select {
        width: 100%;
        padding: 12px;
        background-color: var(--color-dark);
        border: 1px solid var(--color-accent);
        border-radius: 6px;
        color: var(--color-light);
        font-size: 1rem;
        transition: border-color 0.3s;
    }
    .form-group input[type="date"] {
        /* Ensure date input looks good */
        -webkit-appearance: none;
        appearance: none;
    }
    .form-group input:focus, .form-group select:focus {
        border-color: var(--color-secondary);
        outline: none;
    }
    .btn {
        width: 100%; 
        padding: 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: background-color 0.3s;
    }
    .btn.secondary {
        background-color: var(--color-secondary);
        color: var(--color-dark);
    }
    .btn.secondary:hover {
        background-color: #ffe84c;
    }
    .switch-link {
        display: block;
        text-align: center;
        margin-top: 20px;
        font-size: 0.9rem;
    }
    .switch-link a {
        color: var(--color-primary);
        font-weight: 600;
        text-decoration: none;
    }
    .switch-link a:hover {
        text-decoration: underline;
    }
  </style>
</head>
<body>

  <main>
    <div class="form-card">
        <h2>NEW USER REGISTRATION</h2>
        <form id="register-form">
            <div class="form-group">
                <label for="register-username">Username</label>
                <input type="text" id="register-username" required>
            </div>
            <div class="form-group">
                <label for="register-email">Email Address</label>
                <input type="email" id="register-email" required>
            </div>
            <div class="form-group">
                <label for="register-password">Password (min 6 characters)</label>
                <input type="password" id="register-password" minlength="6" required>
            </div>
            <div class="form-group">
                <label for="register-birthdate">Birthdate</label>
                <input type="date" id="register-birthdate" required>
            </div>
            <div class="form-group">
                <label for="register-city-address">City Address</label>
                <input type="text" id="register-city-address" required>
            </div>
            <div class="form-group">
                <label for="register-role">Select Role</label>
                <select id="register-role" required>
                    <option value="customer">CUSTOMER</option>
                    <option value="vip customer">VIP CUSTOMER</option>
                    <option value="manager">MANAGER</option>
                    <option value="staff">STAFF</option>
                    <option value="cafe manager">CAFE MANAGER</option>
                    <option value="admin">ADMIN</option>
                </select>
            </div>
            <button type="submit" class="btn secondary">REGISTER ACCOUNT</button>
        </form>
        <p class="switch-link">
            Already have an account? <a href="login.html">Login Here</a>
        </p>
    </div>
  </main>

<script>
    const authUrl = 'auth.php'; 

    document.getElementById('register-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('register-username').value;
        const email = document.getElementById('register-email').value;
        const password = document.getElementById('register-password').value;
        const birthdate = document.getElementById('register-birthdate').value;
        const city_address = document.getElementById('register-city-address').value;
        const role = document.getElementById('register-role').value;
        
        if (!username || !email || password.length < 6 || !role || !birthdate || !city_address) {
            alert('Please fill out all fields correctly.');
            return;
        }

        try {
            const response = await fetch(authUrl, {
                method: 'POST', 
                body: JSON.stringify({ 
                    action: 'register', 
                    username, 
                    email, 
                    password, 
                    birthdate, // Sending new fields
                    city_address, // Sending new fields
                    role 
                }),
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await response.json();

            if (data.success) {
                alert('Registration successful! You can now log in.');
                window.location.href = 'login.html';
            } else {
                alert(data.message || 'Registration failed. Please try again.');
            }
        } catch (error) {
            console.error("Registration Error:", error);
            alert('A connection error occurred. Please try again.');
        }
    });

    // Check if the user is already logged in (redirects if logged in)
    async function checkExistingLogin() {
        const response = await fetch(authUrl, {
            method: 'POST', body: JSON.stringify({ action: 'status' }),
            headers: { 'Content-Type': 'application/json' }
        });
        const data = await response.json();
        
        if (data.isLoggedIn) {
            window.location.href = 'profile.html';
        }
    }
    document.addEventListener('DOMContentLoaded', checkExistingLogin);
</script>

</body>
</html>